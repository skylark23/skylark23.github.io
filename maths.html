<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Zoom Class</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    a {
      cursor: pointer;
      text-decoration: none;
    }
    #deleteContainer a {
      color: red;
      font-size: 0.95em;
    }
  </style>
</head>
<body>

  <h1>
    <a href="#" id="zoomLink">Join Zoom Class</a>
  </h1>

  <p id="deleteContainer" style="display:none;">
    <a href="#" id="deleteLink">
      Delete previous class recording for
      <strong><span id="lastTime"></span></strong>
    </a>
  </p>

  <script>
    const SCRIPT_URL =
      "https://script.google.com/macros/s/AKfycbxLvEXML3yhQf8tzuiOw8FVOipGPLahg4DOwY7nd5bDbSTy5l9_9tJIvupLut0K4Wkj/exec";

    const ZOOM_URL =
      "https://us06web.zoom.us/j/3526108363?pwd=J8V6Ps7JhPgpZ4BpINi4PEA6X59Cpf.1";

    /* ========= JOIN ZOOM ========= */
    document.getElementById("zoomLink").addEventListener("click", function (e) {
      e.preventDefault();

      fetch(SCRIPT_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body:
          "ip=" + encodeURIComponent(location.hostname) +
          "&name=" + encodeURIComponent("Aarnav")
      });

      window.location.href = ZOOM_URL;
    });

    /* ========= JSONP CALLBACK ========= */
    function showLast(data) {
      if (!data.empty) {
        document.getElementById("lastTime").innerText = data.estTime;
        document.getElementById("deleteContainer").style.display = "block";
      }
    }

    /* ========= LOAD LAST RECORD ========= */
    const script = document.createElement("script");
    script.src = SCRIPT_URL + "?action=getLast&callback=showLast";
    document.body.appendChild(script);

    /* ========= DELETE LAST RECORD ========= */
    document.getElementById("deleteLink").addEventListener("click", function (e) {
      e.preventDefault();

      if (!confirm("Are you sure you want to delete the previous class record?")) {
        return;
      }

      fetch(SCRIPT_URL + "?action=deleteLast")
        .then(() => location.reload());
    });
  </script>

</body>
</html>
